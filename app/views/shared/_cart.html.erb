<details id='current-cart-details' data-controller='cart-details'
  class="table-responsive w-100 bg-white">
  <summary class='fw-bolder p-2 border-bottom border-2 border-dark'
    data-action='click->cart-details#toggle'>
    Cart total: <%= price_format(cart.total_price) %>
  </summary>

  <% if cart.line_items.length != 0 && !@ordering %>
    <section class='d-flex justify-content-between p-3'>
      <%= button_to 'Empty my cart',
      cart_url(cart), method: :delete, data: { confirm: 'Are you sure?'},
      form: { class: "d-inline" }, class: "border-0 text-decoration-underline" %>
      <%= link_to 'Checkout', checkout_path %>
    </section>
  <% end %>

  <table class="table">
    <thead>
      <tr>
        <th scope="col">Item</th>
        <th scope="col">Price</th>
        <th scope="col">Quantity</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <% cart.line_items.order(:created_at).each do |item| %>
      <tr class="<% if @new_item&.id == item.id %>added<% end %>">
        <td>
          <%= link_to "#{item.product.name}", product_url(item.product) %>
        </td>
        <td><%= price_format(item.price) %></td>
        <td> x <%= item.quantity %></td>
        <td>
          <% if @ordering %>
            <%= button_to 'remove', line_item_path(item), method: :delete,
              class: 'btn btn-sm border-0 text-decoration-underline',
              params: { ordering: true } %>
            <% else %>
            <%= button_to 'remove', line_item_path(item), method: :delete,
              class: 'btn btn-sm border-0 text-decoration-underline' %>
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
</details>
